## **ICMP 协议**

- **全称**：互联网控制报文协议（Internet Control Message Protocol）。
    
- **作用**：主要用于在 IP 网络中传递**控制消息**，报告数据包在传输过程中遇到的问题，以便发送方能调整传输策略。
    
- **主要功能**：
    
    1. **确认 IP 包送达**：用于诊断 IP 包是否成功到达目标地址。
        
    2. **报告失败原因**：当 IP 包因某种原因（如网络拥堵、目标不可达）被丢弃时，ICMP 负责将具体原因通知给发送方。
        
    3. **改善网络设置**：通过这些控制消息，可以帮助网络管理员诊断并优化网络性能。
        
![[Pasted image 20250920192825.png]]
### **工作原理**

当数据包在传输过程中遇到问题（例如，路由器找不到目标地址），负责处理该数据包的设备（如路由器）会生成一个 **ICMP 消息**。

- 这个 ICMP 消息会封装在一个 **IP 包**中，然后发回给原始的发送方。
    
- 发送方接收到 ICMP 包后，会解析其头部和数据域，从而得知数据包失败的具体原因，并采取相应的措施。
    

例如，当主机 A 向主机 B 发送数据包，但中间的路由器 2 找不到主机 B，路由器 2 就会向主机 A 发送一个 **“目标不可达”** 的 ICMP 消息。

### **ICMP 消息类型**

ICMP 消息大致分为两类：

1. **差错报文类型**：用于通知发送方数据包在传输过程中遇到的错误，例如：
    
    - 目标不可达（Destination Unreachable）
        
    - 源站抑制（Source Quench，用于告知发送方放慢发送速度）
        
    - 重定向（Redirect）
        
    - 超时（Time Exceeded）
        
2. **查询报文类型**：用于网络诊断，最常见的例子就是 `ping` 命令，它发送 **ICMP Echo 请求**消息，并等待目标返回 **ICMP Echo 响应**消息，以此来测试网络连通性。![[Pasted image 20250920192720.png]]