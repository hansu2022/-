本文知识点
- [[网络协议]]
- [[ARP协议]]
![[Pasted image 20250920133158.png]]
### **TCP/IP 模型的四层结构**

TCP/IP 模型是互联网的实际标准，其 **四层结构** 和 OSI 模型的关系如下：

| TCP/IP 层   | OSI 层       | 核心功能                                                                                                                           |
| ---------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------ |
| 应用层        | 应用层、表示层、会话层 | 1. 提供用户应用接口，处理特定应用数据，支持网页浏览（HTTP）、文件传输（FTP）、电子邮件（SMTP）等常见应用场景；<br><br>2. 负责数据格式转换、加密解密（如 HTTPS 加密）；<br><br>3. 管理通信会话的建立、维护与终止。 |
| 传输层        | 传输层         | 1. 提供端到端（进程到进程）的数据传输服务，衔接应用层与网络层；<br><br>2. 核心协议包括 TCP（可靠传输，保证数据无丢失、不乱序，适用于文件传输）和 UDP（无连接快速传输，不保证可靠性，适用于视频通话、直播）。              |
| 网络层        | 网络层         | 1. 负责跨网络的数据包路由与转发，实现不同局域网、广域网间的通信；<br><br>2. 通过 IP 地址进行逻辑寻址，确定数据包的源地址和目标地址；<br><br>3. 计算并选择数据包传输的最佳路由路径。                       |
| 网络接口层（链路层） | 数据链路层、物理层   | 1. 负责局域网内的物理数据传输，通过 MAC 地址进行设备物理寻址；<br><br>2. 数据链路层：管理数据帧封装、差错控制（如 CRC 校验）和流量控制；<br><br>3. 物理层：定义比特流传输的硬件标准，如电压、网线类型、接口规格。     |

### 应用层
- **定义**：我们日常使用的所有应用软件，如浏览器、邮件客户端等，都工作在这一层。

- **功能**：应用层专注于为用户提供具体的应用功能。它只负责将应用数据交给下一层（传输层），而不用关心数据是如何在网络中传输的。这就像寄快递，你只需要把包裹交给快递员，不用操心他怎么运输。

- **协议**：常见的应用层协议有 **HTTP**（网页浏览）、**FTP**（文件传输）、**DNS**（域名解析）和 **SMTP**（邮件发送）等。

- **工作状态**：应用层运行在操作系统的**用户态**。

### 传输层
- **定义**：传输层为应用层提供网络支持，**接收**来自应用层的数据包。
    
- **协议**：主要有两种协议：
    
    - **TCP**（传输控制协议）：是一种**可靠**的协议。它提供了许多特性来保证数据准确传输，比如**流量控制**、**超时重传**和**拥塞控制**。大多数应用（如HTTP）都使用它。
        
    - **UDP**（用户数据报协议）：是一种**不可靠**的协议。它只负责发送数据包，不保证对方是否收到。因此，它的**实时性**和**传输效率**更高。如果需要，也可以在应用层上自行实现可靠传输的机制。

**数据分块**：当数据包超过 **MSS**（TCP最大报文段长度）时，TCP 会将数据包切分成多个**TCP 段（TCP Segment）**。这样做的好处是，如果某个分块丢失或损坏，只需要重新发送这一个分块即可，不需要重发整个数据包。
![[Pasted image 20250920133419.png]]
**端口号**：传输层通过**端口号**来区分不同的应用。当接收数据时，它会根据报文中的端口号，将数据正确地发送给对应的应用。例如，Web服务器通常使用 **80 端口**，远程登录服务使用 **22 端口**。客户端的每个标签页或进程也会被系统分配一个临时端口号。
- **FTP (文件传输协议)**:- **20/TCP**: 用于数据传输。- **21/TCP**: 用于控制连接。
- **SSH (安全外壳协议)**:- **22/TCP**: 用于加密的远程登录和文件传输。
- **Telnet**:- **23/TCP**: 用于不加密的远程命令行访问，现已被SSH广泛取代。
- **SMTP (简单邮件传输协议)**:- **25/TCP**: 用于电子邮件的发送。
- **DNS (域名系统)**:- **53/TCP** 和 **53/UDP**: TCP用于区域传输，UDP用于常规查询。
- **HTTP (超文本传输协议)**:- **80/TCP**: 用于不加密的网页浏览。
- **POP3 (邮局协议版本3)**:- **110/TCP**: 用于接收电子邮件。
- **IMAP (互联网消息访问协议)**:- **143/TCP**: 用于从服务器管理和检索电子邮件。
- **HTTPS (安全超文本传输协议)**- **443/TCP**: 用于加密的网页浏览。
### 网络层
- **功能**：网络层主要负责将数据从**一个设备传输到另一个设备**。它解决了复杂的网络路径和节点选择问题，将数据传输的实际工作从传输层中解耦出来，让传输层能保持简单高效。
  注意传输层**不负责**将数据从一个设备传输到另一个设备
- **核心协议**：最常用的协议是 **IP（Internet Protocol）协议**。它将传输层的数据报文作为数据部分，再添加 IP 包头，组成一个 **IP 报文**。

- **数据分片**：如果 IP 报文的大小超过 **MTU**（最大传输单元，以太网中通常为1500字节），IP 协议会再次进行分片，以便在网络中传输。
![[Pasted image 20250920134018.png]] **IP 地址**：为了在茫茫设备中找到目标设备，网络层使用 **IP 地址**为每个设备编号。
    
     IPv4协议使用一个 32 位的地址，通常表示为四段，例如：`192.168.100.1`。
     
- **网络号与主机号**：IP 地址被分为两部分，以简化寻址：
    
    - **网络号**：标识设备属于哪个**子网**。
    - **主机号**：标识同一子网下的不同**主机**。
- **子网掩码**：要区分网络号和主机号，需要配合**子网掩码**。
    
    - 子网掩码可以简化表示，例如 `255.255.255.0` 可以简写为 `/24`，因为它二进制形式有 24 个 `1`。255.255.255.0 二进制是「11111111-11111111-11111111-00000000」
    - **计算方式**：
        - **网络号** = IP 地址 **按位与** 子网掩码
            
        - **主机号** = IP 地址 **按位与** 子网掩码的**反码**
            
- **寻址过程**：路由器在寻址时，会先通过 IP 地址和子网掩码计算出网络号，并将其与目标地址的网络号进行匹配，找到正确的子网，然后将数据包转发到该网络内。

将 10.100.122.2 和 255.255.255.0 进行**按位与运算**就可以得到网络号
![[Pasted image 20250920134229.png]]
将 255.255.255.0 取反后与IP地址进行进行**按位与运算**，就可以得到主机号。
https://tool.chinaz.com/Tools/subnetmask 自己改变下「掩码位」的数值，就能体会到子网掩码的作用了
![[Pasted image 20250920134443.png]]
#### 路由
- **定义**：由于设备间通过许多路由器、交换机等网络设备连接，会形成多条网络路径。**路由**就是决定数据包在网络节点中下一步该走哪条路径的过程。
    
- **类比**：如果说 IP 协议的**寻址**能力像是在导航，告诉你下一步应该朝哪个方向走，那么**路由**就是根据这个方向，实际操作方向盘，为你选择具体的路径。
![[Pasted image 20250920134501.png]]

### 网络接口层
- **功能**：网络接口层是网络协议栈的最底层，负责在**局域网（LAN）**内进行数据传输。它在 IP 报文的基础上，添加 MAC 头部**，将其封装成**数据帧**，然后发送到网络上。
    
- **工作载体**：这一层主要工作在**网卡**这个硬件层次，使用的技术包括以太网、Wi-Fi 等。
    
- **MAC 地址**：
    
    - **定义**：为了在以太网这类局域网中识别设备，网络接口层使用 **MAC 地址**来唯一标识网络上的设备。
        
    - **作用**：MAC 头部中包含了发送方和接收方的 MAC 地址，这使得数据包可以在以太网内正确地找到目的地。
        
    - **获取方式**：通常通过 **ARP 协议**（地址解析协议）来获取对方的 MAC 地址。
        
- **与 IP 层的区别**：
    
    - IP 头部中的 IP 地址用于全局网络寻址，而 MAC 头部中的 MAC 地址仅用于局域网内部的寻址。因此，在局域网内通信时，必须将 IP 地址转换为 MAC 地址才能找到正确的设备
![[Pasted image 20250920135154.png]]