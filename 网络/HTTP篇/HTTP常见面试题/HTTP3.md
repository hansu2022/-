![[Pasted image 20250925182649.png]]
**HTTP/3** 的最大变革在于**将底层的传输协议从 TCP 切换为 UDP**，并在此之上运行 **QUIC**（Quick UDP Internet Connections）协议。这一改变旨在从根本上解决 HTTP/1.1 和 HTTP/2 中都存在的队头阻塞问题。

|协议版本|传输层协议|队头阻塞问题|改进点|
|---|---|---|---|
|**HTTP/1.1**|TCP|存在（请求和响应都串行，属于 **HTTP 层**）|-|
|**HTTP/2**|TCP|存在（丢包会阻塞所有请求，属于 **TCP 层**）|Stream 多路复用解决了 HTTP 层的队头阻塞。|
|**HTTP/3**|**QUIC (基于 UDP)**|**解决**（Stream 之间相互独立）|从传输层彻底解决了队头阻塞。|
### QUIC 协议的 3 大核心特性
### 1. 无队头阻塞 (Head-of-Line Blocking Free)

**机制：**
- QUIC 协议沿用了类似 HTTP/2 的 **Stream**（流）和**多路复用**概念，可以在同一条连接上并发传输多个 Stream，每个 Stream 视为一个独立的 HTTP 请求。
- **Stream 独立性：** QUIC 连接上的**多个 Stream 之间相互独立**，不互相依赖。
- **影响：** 当某个 Stream 发生**丢包**时，**只会阻塞这一个流**，QUIC 有机制保证其可靠性；而**其他 Stream 不会受到影响**，可以继续传输数据。
- **效益：** 彻底解决了因 TCP 丢包而导致的**传输层队头阻塞**问题。
![[Pasted image 20250925183252.png]]
### 2. 更快的连接建立 (Faster Connection Establishment)

**机制：**
- 在传统的 HTTP/1 和 HTTP/2 中，**TCP 握手**和 **TLS 握手**是分层、分批次进行的，至少需要 **2~3 个 RTT** 才能建立安全连接。
- **QUIC 内部集成 TLS：** QUIC 协议**内部集成了 TLS**（采用 **TLS 1.3**），将建立连接和密钥协商的过程合并。
- **效益：**
    - **首次连接：** 仅需 **1 个 RTT** 就可以同时完成建立连接与密钥协商。
![[Pasted image 20250925183312.png]]
    - **会话恢复/第二次连接：** 可以达到 **0-RTT** 的效果，应用数据包可以直接和 QUIC 握手信息一起发送，极大地加速了连接建立过程。
- **握手目的：** 握手过程主要是为了确认双方的**连接 ID**，连接迁移就是基于这个 ID 实现的。
![[Pasted image 20250925183319.png]]

### 3. 连接迁移 (Connection Migration)

**机制：**

- **传统 HTTP (基于 TCP)：** 一条 TCP 连接由**四元组**（源 IP、源端口、目的 IP、目的端口）唯一确定。当移动设备网络切换（如 4G 切换到 Wi-Fi）导致 IP 地址变化时，连接必须断开重连，会带来高昂的**重连成本**（TCP/TLS 握手、TCP 慢启动）。
![[Pasted image 20250925183357.png]]
- **QUIC (基于连接 ID)：** QUIC **不使用四元组**来“绑定”连接，而是使用**连接 ID** 来标记通信的两个端点。
    
- **效益：** 即使客户端的 IP 地址或端口发生变化（如网络切换），只要保留了原有的连接 ID 和上下文信息（如 TLS 密钥），就可以“**无缝**”地复用原连接，无需断开和重连，消除了重连带来的卡顿感。